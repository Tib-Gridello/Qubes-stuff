#!/bin/bash

# Ensure the script is run as root
if [ "$EUID" -ne 0 ]; then 
    echo "Please run as root."
    exit
fi

# Check if Kali source is already in sources.list
if ! grep -q "http://http.kali.org/kali kali-rolling" /etc/apt/sources.list; then
    # Add Kali source to source list
    echo "deb http://http.kali.org/kali kali-rolling main non-free contrib" >> /etc/apt/sources.list
else
    echo "Kali source is already present. Skipping addition."
fi

# Comment out other Debian sources
sed -i 's/^deb \(http[^ ]*debian[^ ]*\)/#&/g' /etc/apt/sources.list

apt-key add archive-key.asc
# Update, upgrade, and dist-upgrade
apt update && apt upgrade -y && apt dist-upgrade -y

# Install kali-linux-everything
apt install kali-linux-everything -y

# Add user kali
if id "kali" &>/dev/null; then
    echo "User kali already exists. Skipping addition."
else
    useradd -m -G user,qubes kali
fi

# Change shell for user kali to /bin/bash
chsh -s /bin/bash kali

